<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Broadcast Messages</title>
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<h1>Broadcast Messages</h1>
	<div id="messages-container"></div>

	<h2>Post a New Message</h2>
	<form id="message-form">
		<label for="sender-name">Your Name: (Optional)</label>
		<input type="text" id="sender-name" name="sender-name">
		<label for="message">Message:</label>
		<textarea id="message" name="message" required></textarea>
		<button type="submit">Send Message</button>
	</form>

	<script>
		// Function to handle form submission
		async function handleSubmit(event) {
			event.preventDefault();
			const senderName = document.getElementById('sender-name').value;
			const message = document.getElementById('message').value;

			try {
				const response = await fetch('/api/broadcast', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({
						senderName,
						msg: message
					})
				});

				if (response.ok) {
					// Clear form fields after successful submission
					document.getElementById('sender-name').value = '';
					document.getElementById('message').value = '';
					// Fetch messages again to update the list
					fetchMessages();
				} else {
					console.error('Failed to post message:', response.statusText);
				}
			} catch (error) {
				console.error('Error posting message:', error);
			}
		}

		// Fetch messages from the backend API
		async function fetchMessages() {
			try {
				const response = await fetch('/api/broadcast');
				const messages = await response.json();

				const messagesContainer = document.getElementById('messages-container');
				messagesContainer.innerHTML = '';

				if (messages.length === 0) {
					messagesContainer.innerHTML = '<p>No messages found</p>';
				} else {
					messages.forEach(message => {
						const messageElement = document.createElement('div');
						messageElement.classList.add('message');
						messageElement.innerHTML = `
                            <p><strong>${message.senderName}</strong>: ${message.body}</p>
                            <p>Sent at: ${new Date(message.sentAt).toLocaleString()}</p>
                        `;
						messagesContainer.appendChild(messageElement);
					});
				}
			} catch (error) {
				console.error('Error fetching messages:', error);
			}
		}

		// Fetch messages when the page loads
		fetchMessages();

		// Add event listener to form submission
		document.getElementById('message-form').addEventListener('submit', handleSubmit);
	</script>
</body>

</html>
